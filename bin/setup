#!/usr/bin/env bash

# homebrew #############################################################################################################
if ! hash brew 2>/dev/null; then
    ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
else
    echo 'brew founded';
fi

# apps #################################################################################################################
    # go
    # mysql
    # nginx
    # pyenv
    # tig
apps=(
    git
    svn
    the_silver_searcher
    vim
)
brew update
for app in ${apps[@]}; do
    echo "install $app"
    brew install $app && brew upgrade $app
done

# nodejs ###############################################################################################################
# nvm
if ! hash nvm 2>/dev/null; then
    export NVM_DIR="$HOME/.nvm" && (
        git clone https://github.com/creationix/nvm.git "$NVM_DIR"
        cd "$NVM_DIR"
        git checkout `git describe --abbrev=0 --tags --match "v[0-9]*" origin`
    ) && . "$NVM_DIR/nvm.sh"
else
    echo 'nvm founded';
fi
# node
if ! hash node 2>/dev/null; then
    nvm install node
    nvm use node
else
    echo 'node founded';
fi
# global node modules
global_node_modules=(
    cleancss
    cnpm
    depv
    file-encoder
    gulp
    jshint
    less
    module-path
    tnpm
    uglify-js
    zfinder
)
for node_module in ${global_node_modules[@]}; do
    npm install -g $node_module
done

# perl #################################################################################################################
# PERL_VERSION=perl-5.16.0
# if ! hash perlbrew 2>/dev/null; then
#     curl -L http://install.perlbrew.pl | bash
# else
#     echo 'perlbrew founded';
# fi
# source ~/perl5/perlbrew/etc/bashrc
# perlbrew install $PERL_VERSION
# perlbrew switch $PERL_VERSION
# # perl cpans
# if ! hash cpanm 2>/dev/null; then
#     curl -L http://cpanmin.us | perl - App::cpanminus
# fi

# python ###############################################################################################################
# PYTHON2VERSION=2.7.6
# PYTHON3VERSION=3.3.3
# pyenv install $PYTHON2VERSION
# pyenv install $PYTHON3VERSION
# pyenv global  $PYTHON3VERSION $PYTHON2VERSION

# ruby #################################################################################################################
# RUBY_VERSION=2.1.3
# if ! hash rvm 2>/dev/null; then
#     curl -L https://get.rvm.io | bash -s stable --autolibs=enabled --ruby --rails
# else
#     echo 'rvm founded';
# fi
# rvm install $RUBY_VERSION
# rvm use     $RUBY_VERSION
# global gems
# ruby_gems=(
#     tmuxinator
# )
# for ruby_gem in ${ruby_gems[@]}; do
#     gem install $ruby_gem
# done

# golang ###############################################################################################################

# repos ################################################################################################################
# repo home
USERNAME=leungwensen
REPO_DIR=$HOME/repo
mkdir $REPO_DIR
# github
GITHUB_HTTPS=https://github.com/
GITHUB_SSH=git@github.com:
GITHUB_PUBLIC_REPOS=(
    altercation/ethanschoonover.com
)
for repo in ${GITHUB_HTTPS[@]}; do
    if [ -e $REPO_DIR/$repo ]; then
        cd $REPO_DIR/$repo
        echo "update $repo"
        git pull
    else
        cd $REPO_DIR
        echo "clone $repo"
        git clone $GITHUB_HTTPS$repo.git $repo
    fi
done
GITHUB_PERSONAL_REPOS=(
    amd-module
    blog
    depv
    file-encoder
    lab
    node-module-path
    svg-icon
    template2module
    toolbox
    try2get
    wiser-javascript
    xmind-sdk-javascript
    xml-lite
    zero-colors
    zero-declare
    zero-lang
    zero-locale
    zfinder
)
for repo in ${GITHUB_SSH[@]}; do
    REPO_NAME=$USERNAME/$repo
    if [ -e $REPO_DIR/$REPO_NAME ]; then
        cd $REPO_DIR/$REPO_NAME
        echo "update $REPO_NAME"
        git pull
    else
        cd $REPO_DIR
        echo "clone $REPO_NAME"
        git clone $GITHUB_SSH$REPO_NAME.git $REPO_NAME
    fi
done
# gitlab
GITLAB_SSH=git@gitlab.com:
GITLAB_PERSONAL_REPOS=(
    doc
)
for repo in ${GITLAB_PERSONAL_REPOS[@]}; do
    REPO_NAME=$USERNAME/$repo
    if [ -e $REPO_DIR/$REPO_NAME ]; then
        cd $REPO_DIR/$REPO_NAME
        echo "update $REPO_NAME"
        git pull
    else
        cd $REPO_DIR
        echo "clone $REPO_NAME"
        git clone $GITLAB_PERSONAL_REPOS$REPO_NAME.git $REPO_NAME
    fi
done

# toolbox ##############################################################################################################
cd $HOME
# self defined scripts
rm scripts
ln -s $HOME/repo/leungwensen/toolbox/scripts scripts # self defined scripts
# vimrc, bashrc & others
links=(
    .bash_profile
    .bash_profile.d
    .gitconfig
    .gitignore
    .tmux.conf
    .vimperatorrc
    .vimrc
    .vimrc.d
)
for link in ${links[@]}; do
    rm $link
    ln -s $HOME/repo/leungwensen/toolbox/dotfiles/$link $link
done
# make the magic happen
source $HOME/.bash_profile
